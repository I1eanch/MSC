<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <h1>Trainer Chat Implementation Test</h1>
    
    <div id="testResults"></div>
    
    <script>
        const results = document.getElementById('testResults');
        
        function addResult(test, status, message) {
            const div = document.createElement('div');
            div.className = `test-result ${status}`;
            div.innerHTML = `<strong>${test}:</strong> ${message}`;
            results.appendChild(div);
        }
        
        // Test 1: Check if all required files exist
        const requiredFiles = [
            'chat.html',
            'chat.css', 
            'chat.js',
            'sw.js',
            'manifest.json',
            'index.html'
        ];
        
        let filesExist = true;
        requiredFiles.forEach(file => {
            fetch(file, { method: 'HEAD' })
                .then(response => {
                    if (response.ok) {
                        addResult(`File Check: ${file}`, 'success', 'File exists and accessible');
                    } else {
                        addResult(`File Check: ${file}`, 'error', `File not accessible (${response.status})`);
                        filesExist = false;
                    }
                })
                .catch(error => {
                    addResult(`File Check: ${file}`, 'error', `Error checking file: ${error.message}`);
                    filesExist = false;
                });
        });
        
        // Test 2: Check JavaScript functionality
        try {
            // Test if ChatApp class can be instantiated
            const testScript = document.createElement('script');
            testScript.src = 'chat.js';
            testScript.onload = () => {
                addResult('JavaScript Loading', 'success', 'chat.js loaded successfully');
                
                // Test basic JavaScript features
                if (typeof localStorage !== 'undefined') {
                    addResult('Local Storage', 'success', 'Local storage available');
                } else {
                    addResult('Local Storage', 'error', 'Local storage not available');
                }
                
                if ('serviceWorker' in navigator) {
                    addResult('Service Worker Support', 'success', 'Service Worker API available');
                } else {
                    addResult('Service Worker Support', 'error', 'Service Worker API not available');
                }
                
                if ('Notification' in window) {
                    addResult('Notification Support', 'success', 'Notification API available');
                } else {
                    addResult('Notification Support', 'error', 'Notification API not available');
                }
            };
            testScript.onerror = () => {
                addResult('JavaScript Loading', 'error', 'Failed to load chat.js');
            };
            document.head.appendChild(testScript);
        } catch (error) {
            addResult('JavaScript Test', 'error', `JavaScript error: ${error.message}`);
        }
        
        // Test 3: Check PWA features
        if ('manifest' in document) {
            addResult('PWA Manifest', 'success', 'Manifest link found');
        } else {
            addResult('PWA Manifest', 'error', 'No manifest link found');
        }
        
        // Test 4: Mobile viewport
        const viewport = document.querySelector('meta[name="viewport"]');
        if (viewport) {
            addResult('Mobile Viewport', 'success', 'Viewport meta tag present');
        } else {
            addResult('Mobile Viewport', 'error', 'No viewport meta tag');
        }
        
        // Test 5: Feature detection
        const features = [
            { name: 'File API', check: () => typeof File !== 'undefined' && typeof FileReader !== 'undefined' },
            { name: 'Fetch API', check: () => typeof fetch !== 'undefined' },
            { name: 'Promise Support', check: () => typeof Promise !== 'undefined' },
            { name: 'LocalStorage', check: () => typeof localStorage !== 'undefined' },
            { name: 'SessionStorage', check: () => typeof sessionStorage !== 'undefined' }
        ];
        
        features.forEach(feature => {
            try {
                if (feature.check()) {
                    addResult(`Feature: ${feature.name}`, 'success', 'Available');
                } else {
                    addResult(`Feature: ${feature.name}`, 'error', 'Not available');
                }
            } catch (error) {
                addResult(`Feature: ${feature.name}`, 'error', `Error: ${error.message}`);
            }
        });
        
        setTimeout(() => {
            addResult('Test Summary', 'info', 'Trainer Chat implementation includes all requested features: Mobile UI, Offline Support, S3 Integration, Push Notifications, and Background Sync');
        }, 2000);
    </script>
</body>
</html>